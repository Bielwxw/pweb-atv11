<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <title>Lista ğŸ“</title>
</head>

<body>
  <h1>Lista de UsuÃ¡rios ğŸ“Œ</h1>

  <table id="table"></table>

  <script>
    let table = document.getElementById("table");

    gerarDadosDaTabela();

    async function excluirUsuario(name, email) {
      const options = {
        method: 'POST',
        body: JSON.stringify({ name, email }),
        headers: { 'Content-Type': 'application/json' }
      }

      await fetch('/lista/json', options)
      gerarDadosDaTabela();
    }

    function gerarDadosDaTabela() {
      fetch('/lista/json')
        .then(res => res.json())
        .then(data => {
          table.innerHTML = "";
          for (let user of data.pessoas) {
            table.innerHTML += `<tr>
              <td>${user.name}</td>
              <td>${user.email}</td>
              <td> <button type="button" onclick="excluirUsuario('${user.name}', '${user.email}')" class="btn btn-danger">Excluir</button> </td>
            </tr>`
          }
        });
    }
  </script>
</body>
</html>